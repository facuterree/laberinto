<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laberinto de Alicia (aleatorio)</title>
<style>
  body {
    margin: 0;
    background-color: #000;
    font-family: 'Trebuchet MS', sans-serif;
    overflow: hidden;
    color: white;
  }

  #game {
    position: relative;
    width: 800px;
    height: 800px;
    margin: 20px auto;
    border: 3px solid #fff;
    background-image: url('https://i.imgur.com/jJ8rWvW.jpeg');
    background-size: cover;
    background-position: center;
    box-shadow: 0 0 40px rgba(255,255,255,0.3);
  }

  .wall {
    position: absolute;
    background-color: rgba(20, 20, 20, 0.85);
    border: 2px solid #555;
  }

  .potion {
    position: absolute;
    width: 30px;
    height: 30px;
    font-size: 24px;
    text-align: center;
    line-height: 30px;
  }

  #player {
    position: absolute;
    width: 40px;
    height: 40px;
    font-size: 32px;
    text-align: center;
    line-height: 40px;
    transition: transform 0.2s ease;
  }

  #exit {
    position: absolute;
    width: 50px;
    height: 50px;
    font-size: 48px;
    text-align: center;
    line-height: 50px;
  }

  #hud {
    color: #fff;
    font-size: 20px;
    text-align: center;
    margin-bottom: 10px;
  }

  #message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-size: 32px;
    text-align: center;
    display: none;
    background: rgba(0,0,0,0.8);
    padding: 20px;
    border-radius: 15px;
  }

  #countdown {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 64px;
    color: #fff;
    background: rgba(0,0,0,0.7);
    padding: 20px 40px;
    border-radius: 20px;
  }
</style>
</head>
<body>
<div id="hud">
  ‚è∞ Tiempo: <span id="timer">15</span>s ‚Äî Nivel: <span id="level">1</span>
</div>
<div id="game">
  <div id="player">üëß</div>
  <div id="exit">üö™</div>
  <div id="message"></div>
  <div id="countdown">3</div>
</div>

<script>
const game = document.getElementById('game');
const player = document.getElementById('player');
const exit = document.getElementById('exit');
const timerEl = document.getElementById('timer');
const levelEl = document.getElementById('level');
const message = document.getElementById('message');
const countdown = document.getElementById('countdown');

let posX = 50, posY = 50;
let speed = 10;
let size = 1;
let timeLeft = 15;
let gameOver = false;
let level = 1;
let potionTimer = null;
let growing = null;
let playing = false;

player.style.left = posX + 'px';
player.style.top = posY + 'px';

// ------------------- GENERADOR ALEATORIO -------------------

function crearLaberintoAleatorio() {
  game.querySelectorAll('.wall, .potion').forEach(e => e.remove());

  // Bordes del mapa
  const bordes = [
    {x:0, y:0, w:800, h:20},
    {x:0, y:0, w:20, h:800},
    {x:780, y:0, w:20, h:800},
    {x:0, y:780, w:800, h:20},
  ];

  bordes.forEach(w => crearPared(w.x, w.y, w.w, w.h));

  // Paredes internas aleatorias
  const cantidadParedes = 10 + level * 3;
  for (let i = 0; i < cantidadParedes; i++) {
    const w = Math.random() < 0.5 ? 20 : 200 + Math.random() * 200;
    const h = w === 20 ? 200 + Math.random() * 400 : 20;
    const x = 40 + Math.random() * (760 - w);
    const y = 40 + Math.random() * (760 - h);
    crearPared(x, y, w, h);
  }

  // Pociones
  const cantidadPociones = 5 + Math.floor(level * 2);
  for (let i = 0; i < cantidadPociones; i++) {
    const px = 50 + Math.random() * 700;
    const py = 50 + Math.random() * 700;
    crearPocion(px, py);
  }

  // Salida aleatoria (m√°s lejos cuanto m√°s nivel)
  const ex = 600 + Math.random() * 150;
  const ey = 600 + Math.random() * 150;
  exit.style.left = ex + 'px';
  exit.style.top = ey + 'px';
}

function crearPared(x, y, w, h) {
  const div = document.createElement('div');
  div.className = 'wall';
  div.style.left = x + 'px';
  div.style.top = y + 'px';
  div.style.width = w + 'px';
  div.style.height = h + 'px';
  game.appendChild(div);
}

function crearPocion(x, y) {
  const div = document.createElement('div');
  div.className = 'potion';
  div.textContent = 'üíß';
  div.style.left = x + 'px';
  div.style.top = y + 'px';
  game.appendChild(div);
}

// ------------------- MEC√ÅNICA DEL JUEGO -------------------

function startLevel() {
  crearLaberintoAleatorio();
  timeLeft = 15;
  timerEl.textContent = timeLeft;
  countdown.textContent = '3';
  countdown.style.display = 'block';
  let c = 3;
  let interval = setInterval(() => {
    c--;
    if (c > 0) countdown.textContent = c;
    else if (c === 0) countdown.textContent = '¬°Vamos!';
    else {
      clearInterval(interval);
      countdown.style.display = 'none';
      playing = true;
      startTimers();
    }
  }, 1000);
}

function startTimers() {
  potionTimer = setInterval(() => {
    if (gameOver || !playing) return;
    timeLeft--;
    timerEl.textContent = timeLeft;
    if (timeLeft <= 0) {
      endGame('‚è∞ Se acab√≥ el tiempo, Alicia qued√≥ atrapada');
    }
  }, 1000);

  // CRECIMIENTO CADA 5 SEGUNDOS (antes era 1)
  let growthCounter = 0;
  growing = setInterval(() => {
    if (gameOver || !playing) return;
    growthCounter++;
    if (growthCounter >= 5) {
      size += 0.07;
      player.style.transform = 'scale(' + size + ')';
      growthCounter = 0;
      if (size >= 2) {
        endGame('üò¢ Alicia creci√≥ demasiado y qued√≥ atrapada');
      }
    }
  }, 1000);
}

function endGame(msg) {
  gameOver = true;
  playing = false;
  clearInterval(potionTimer);
  clearInterval(growing);
  message.style.display = 'block';
  message.textContent = msg;

  setTimeout(() => {
    message.style.display = 'none';
    if (level < 5) {
      level++;
      levelEl.textContent = level;
      gameOver = false;
      size = 1;
      startLevel();
    } else {
      message.style.display = 'block';
      message.textContent = 'üèÅ ¬°Ganaste todos los niveles!';
    }
  }, 3000);
}

function checkCollision(x, y) {
  const playerRect = { left: x, top: y, right: x + 40 * size, bottom: y + 40 * size };
  const walls = document.querySelectorAll('.wall');
  for (const wall of walls) {
    const rect = wall.getBoundingClientRect();
    const g = game.getBoundingClientRect();
    const wallRect = { left: rect.left - g.left, top: rect.top - g.top, right: rect.right - g.left, bottom: rect.bottom - g.top };
    if (playerRect.left < wallRect.right && playerRect.right > wallRect.left && playerRect.top < wallRect.bottom && playerRect.bottom > wallRect.top)
      return true;
  }
  return false;
}

document.addEventListener('keydown', e => {
  if (!playing || gameOver) return;
  let nextX = posX, nextY = posY;
  if (e.key === 'ArrowUp' || e.key === 'w') nextY -= speed;
  if (e.key === 'ArrowDown' || e.key === 's') nextY += speed;
  if (e.key === 'ArrowLeft' || e.key === 'a') nextX -= speed;
  if (e.key === 'ArrowRight' || e.key === 'd') nextX += speed;
  if (!checkCollision(nextX, nextY)) {
    posX = nextX;
    posY = nextY;
    player.style.left = posX + 'px';
    player.style.top = posY + 'px';
    checkPotion();
    checkExit();
  }
});

function checkPotion() {
  const pRect = player.getBoundingClientRect();
  document.querySelectorAll('.potion').forEach(p => {
    const rect = p.getBoundingClientRect();
    if (p.style.display !== 'none' && pRect.x < pRect.width + rect.x && pRect.x + pRect.width > rect.x && pRect.y < pRect.height + rect.y && pRect.y + pRect.height > rect.y) {
      p.style.display = 'none';
      size = 1;
      player.style.transform = 'scale(1)';
      timeLeft = 15;
      timerEl.textContent = timeLeft;
    }
  });
}

function checkExit() {
  const pRect = player.getBoundingClientRect();
  const eRect = exit.getBoundingClientRect();
  if (pRect.x < pRect.width + eRect.x && pRect.x + pRect.width > eRect.x && pRect.y < pRect.height + eRect.y && pRect.y + pRect.height > eRect.y) {
    endGame('üéâ ¬°Lograste salir del laberinto!');
  }
}

// Iniciar directamente el nivel 1 sin vac√≠o previo
levelEl.textContent = level;
startLevel();
</script>
</body>
</html>
