<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Alicia en el laberinto</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: url('https://i.imgur.com/pwYQJkB.jpeg') center/cover no-repeat;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: rgba(0, 0, 0, 0.5);
    border: 4px solid #00ffff;
  }
  #countdown {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 80px;
    color: #fff;
    text-shadow: 2px 2px 10px black;
    font-family: "Comic Sans MS", cursive;
  }
  #level {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 22px;
    font-family: sans-serif;
  }
  #message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: yellow;
    font-size: 36px;
    font-family: "Comic Sans MS", cursive;
    display: none;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="700" height="500"></canvas>
<div id="countdown"></div>
<div id="level">Nivel: 1</div>
<div id="message">Â¡Felicidades, lograste que Alicia salga del laberinto!</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const countdownEl = document.getElementById("countdown");
const levelEl = document.getElementById("level");
const messageEl = document.getElementById("message");

let gridSize = 20;
let maze = [];
let level = 1;
let player = { x: 0, y: 0, size: 1 };
let potions = [];
let door = {};
let keys = {};
let canMove = false;
let growTimer = 0;
let growthInterval = 5;
let potionTime = 15;
let timer = 0;

function generateMaze(rows, cols) {
  const maze = Array(rows)
    .fill(null)
    .map(() => Array(cols).fill(1));
  const stack = [];
  const startRow = Math.floor(Math.random() * rows);
  const startCol = Math.floor(Math.random() * cols);
  maze[startRow][startCol] = 0;
  stack.push([startRow, startCol]);

  const dirs = [
    [0, 2],
    [0, -2],
    [2, 0],
    [-2, 0]
  ];

  while (stack.length) {
    const [r, c] = stack.pop();
    shuffle(dirs);
    for (const [dr, dc] of dirs) {
      const nr = r + dr;
      const nc = c + dc;
      if (nr > 0 && nc > 0 && nr < rows && nc < cols && maze[nr][nc] === 1) {
        maze[nr][nc] = 0;
        maze[r + dr / 2][c + dc / 2] = 0;
        stack.push([nr, nc]);
      }
    }
  }
  return maze;
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function randomEmptyCell() {
  let x, y;
  do {
    x = Math.floor(Math.random() * maze[0].length);
    y = Math.floor(Math.random() * maze.length);
  } while (maze[y][x] === 1);
  return { x, y };
}

function startLevel() {
  const rows = 15 + level * 2;
  const cols = 20 + level * 2;
  maze = generateMaze(rows, cols);

  // Alicia empieza en una celda libre
  const startCell = randomEmptyCell();
  player.x = startCell.x;
  player.y = startCell.y;
  player.size = 1;

  // Puerta en una celda libre alejada
  door = randomEmptyCell();

  // Generar pociones
  potions = [];
  const potionCount = 8 + level * 2;
  for (let i = 0; i < potionCount; i++) {
    potions.push(randomEmptyCell());
  }

  levelEl.textContent = "Nivel: " + level;
  startCountdown();
}

function startCountdown() {
  canMove = false;
  let count = 3;
  countdownEl.textContent = count;
  const interval = setInterval(() => {
    count--;
    if (count > 0) {
      countdownEl.textContent = count;
    } else if (count === 0) {
      countdownEl.textContent = "Â¡Vamos!";
    } else {
      clearInterval(interval);
      countdownEl.textContent = "";
      canMove = true;
      timer = 0;
    }
  }, 1000);
}

function drawMaze() {
  const cellW = canvas.width / maze[0].length;
  const cellH = canvas.height / maze.length;
  for (let y = 0; y < maze.length; y++) {
    for (let x = 0; x < maze[y].length; x++) {
      if (maze[y][x] === 1) {
        ctx.fillStyle = "rgba(0,255,255,0.3)";
        ctx.fillRect(x * cellW, y * cellH, cellW, cellH);
      }
    }
  }
}

function drawPlayer() {
  const cellW = canvas.width / maze[0].length;
  const cellH = canvas.height / maze.length;
  const px = player.x * cellW;
  const py = player.y * cellH;
  const emoji = "ðŸ‘§";
  ctx.font = `${cellH * player.size}px Arial`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(emoji, px + cellW / 2, py + cellH / 2);
}

function drawPotions() {
  const cellW = canvas.width / maze[0].length;
  const cellH = canvas.height / maze.length;
  for (const p of potions) {
    ctx.fillText("ðŸ’§", p.x * cellW + cellW / 2, p.y * cellH + cellH / 2);
  }
}

function drawDoor() {
  const cellW = canvas.width / maze[0].length;
  const cellH = canvas.height / maze.length;
  ctx.fillText("ðŸšª", door.x * cellW + cellW / 2, door.y * cellH + cellH / 2);
}

function move(dx, dy) {
  if (!canMove) return;
  const nx = player.x + dx;
  const ny = player.y + dy;
  if (ny >= 0 && ny < maze.length && nx >= 0 && nx < maze[0].length) {
    if (maze[ny][nx] === 0) {
      player.x = nx;
      player.y = ny;
    }
  }
}

document.addEventListener("keydown", (e) => {
  keys[e.key] = true;
});
document.addEventListener("keyup", (e) => {
  keys[e.key] = false;
});

function update() {
  if (canMove) {
    if (keys["ArrowUp"]) move(0, -1);
    if (keys["ArrowDown"]) move(0, 1);
    if (keys["ArrowLeft"]) move(-1, 0);
    if (keys["ArrowRight"]) move(1, 0);

    // Crecimiento cada 5 segundos
    growTimer += 1 / 60;
    if (growTimer >= growthInterval) {
      player.size += 0.1;
      growTimer = 0;
    }

    // Tiempo para pociÃ³n
    timer += 1 / 60;
    if (timer >= potionTime) {
      canMove = false;
      alert("Â¡Alicia creciÃ³ demasiado! Intenta de nuevo");
      level = 1;
      startLevel();
    }

    // Colisiones con pociones
    potions = potions.filter((p) => {
      if (p.x === player.x && p.y === player.y) {
        timer = 0;
        player.size = Math.max(1, player.size - 0.2);
        return false;
      }
      return true;
    });

    // Llegar a la puerta
    if (player.x === door.x && player.y === door.y) {
      level++;
      if (level > 5) {
        messageEl.style.display = "block";
        canMove = false;
        return;
      }
      startLevel();
    }
  }
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMaze();
  drawDoor();
  drawPotions();
  drawPlayer();
  update();
  requestAnimationFrame(gameLoop);
}

startLevel();
gameLoop();
</script>
</body>
</html>
